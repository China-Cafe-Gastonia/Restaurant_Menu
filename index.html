<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Menu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/common.css">
</head>

<body class="bg-gray-50 text-gray-800">
    <!-- Mobile Menu Toggle Button (Hamburger Icon) -->
    <button id="mobileMenuToggle" class="fixed top-4 left-4 z-50 lg:hidden bg-white p-3 rounded-xl shadow-lg hover:shadow-xl hover:bg-gray-50 transition-all duration-200 border border-gray-200">
        <div class="space-y-1.5">
            <div class="w-6 h-0.5 bg-gray-700 rounded-full transition-all duration-300"></div>
            <div class="w-6 h-0.5 bg-gray-700 rounded-full transition-all duration-300"></div>
            <div class="w-6 h-0.5 bg-gray-700 rounded-full transition-all duration-300"></div>
        </div>
    </button>

    <!-- Scroll to Top Button -->
    <button id="scrollToTop" aria-label="Scroll to top">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
        </svg>
    </button>

    <!-- Main Layout with Sidebar -->
    <div class="flex min-h-screen">
        <!-- Category Navigation Sidebar -->
        <aside id="categoryNav" class="fixed lg:sticky top-0 left-0 h-screen w-72 bg-gradient-to-b from-white to-gray-50 shadow-2xl transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out z-40 flex flex-col border-r border-gray-200">
            <!-- Sidebar Header -->
            <div class="p-6 border-b border-gray-200 bg-white">
                <div class="flex items-center justify-between mb-1">
                    <h2 class="text-xl font-bold text-gray-900 flex items-center gap-3">
                        <span class="text-2xl">üçú</span>
                        <span>Menu</span>
                    </h2>
                    <!-- Close button for mobile -->
                    <button id="closeSidebar" class="lg:hidden p-2 hover:bg-gray-100 rounded-lg transition-colors">
                        <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                <p class="text-sm text-gray-500">Select a category</p>
            </div>
            
            <!-- Category List -->
            <div class="flex-1 overflow-y-auto p-4">
                <nav id="categoryList" class="space-y-1">
                    <!-- Categories will be dynamically added here -->
                </nav>
            </div>
            
            <!-- Admin/Menu Links at bottom -->
            <div class="border-t border-gray-200 p-4 bg-white">
                <div class="space-y-2">
                    <a href="index.html" class="flex items-center justify-center gap-2 px-4 py-3 text-blue-600 font-semibold bg-blue-50 rounded-xl hover:bg-blue-100 transition-all duration-200 shadow-sm">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                        <span>Public Menu</span>
                    </a>
                    <a href="admin.html" class="flex items-center justify-center gap-2 px-4 py-3 text-gray-600 hover:text-gray-900 bg-gray-50 hover:bg-gray-100 rounded-xl transition-all duration-200">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                        </svg>
                        <span>Admin Panel</span>
                    </a>
                </div>
            </div>
        </aside>

        <!-- Overlay for mobile -->
        <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 lg:hidden hidden transition-opacity duration-300"></div>

        <!-- Main Content -->
        <main class="flex-1 lg:ml-0 pt-16 lg:pt-0 w-full">
            <div class="max-w-4xl mx-auto px-4 py-8">
                <header class="text-center mb-8">
                    <h1 id="restaurantName" class="text-4xl font-extrabold text-gray-900"></h1>
                    <div id="restaurantInfo" class="text-lg text-gray-600 mt-2"></div>
                    <div id="restaurantNotes" class="mt-4"></div>
                </header>

                <div id="loadingMessage" class="text-center text-gray-500 text-lg">
                    Loading menu...
                </div>

                <div id="menuContainer">
                </div>
            </div>
        </main>
    <script type="module">
        // Import Firebase configuration
        import { db, appId } from './js/firebase-config.js';
        import { collection, onSnapshot } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";
        
        // Import utility functions
        import { normalizeMenuItem } from './js/utils/normalize.js';
        import { formatPrice, to12Hour, normalizeIngredientToken } from './js/utils/formatters.js';
        import { setupGlobalErrorHandlers, logError, logInfo, showNotification } from './js/utils/error-handling.js';
        import { escapeHtml, escapeAttr } from './js/utils/sanitize.js';

        // Initialize global error handlers
        setupGlobalErrorHandlers();

        // Filtering state for public page
        let _cachedMenuItems = [];
        const ingredientFilters = new Set();
        let spicyOnlyFilter = false;

        function renderFilterBar(menuDocs) {
            // Collect unique ingredients
            const ingredientSet = new Map(); // token -> display
            menuDocs.forEach(it => {
                const ing = it.ingredients;
                if (!ing) return;
                if (Array.isArray(ing)) {
                    ing.forEach(i => ingredientSet.set(normalizeIngredientToken(i), i.trim()));
                } else if (typeof ing === 'string') {
                    ing.split(/[\n,]/).map(s => s.trim()).filter(Boolean).forEach(i => ingredientSet.set(normalizeIngredientToken(i), i));
                }
            });

            const menuContainer = document.getElementById('menuContainer');
            // Create or replace filter bar at top
            let filterBar = document.getElementById('filterBar');
            if (!filterBar) {
                filterBar = document.createElement('div');
                filterBar.id = 'filterBar';
                filterBar.className = 'mb-4 flex flex-wrap items-center gap-2';
                menuContainer.appendChild(filterBar);
            }
            // Build HTML for tags
            const parts = [];
            // Spicy toggle
            parts.push(`<button data-filter-spicy="1" class="px-3 py-1 rounded-full text-sm ${spicyOnlyFilter ? 'bg-red-100 text-red-800' : 'bg-gray-100 text-gray-700'}">üå∂Ô∏è Spicy</button>`);
            // Ingredient tags
            Array.from(ingredientSet.entries()).sort((a,b)=> a[1].localeCompare(b[1])).forEach(([token, display]) => {
                const active = ingredientFilters.has(token);
                parts.push(`<button data-ingredient="${encodeURIComponent(token)}" class="px-3 py-1 rounded-full text-sm ${active ? 'bg-yellow-100 text-yellow-800' : 'bg-gray-100 text-gray-700'}">${escapeHtml(display)}</button>`);
            });

            filterBar.innerHTML = parts.join('');

            // Attach handlers
            filterBar.querySelectorAll('[data-ingredient]').forEach(btn => {
                btn.addEventListener('click', () => {
                    const token = decodeURIComponent(btn.getAttribute('data-ingredient'));
                    if (ingredientFilters.has(token)) ingredientFilters.delete(token); else ingredientFilters.add(token);
                    renderMenu(_cachedMenuItems);
                });
            });
            const spicyBtn = filterBar.querySelector('[data-filter-spicy]');
            if (spicyBtn) {
                spicyBtn.addEventListener('click', () => {
                    spicyOnlyFilter = !spicyOnlyFilter;
                    renderMenu(_cachedMenuItems);
                });
            }
        }

        // Build details HTML for an item: group units by size and render options per-size
        function buildDetailsHtml(item) {
            // Units take precedence
            if (Array.isArray(item.unit) && item.unit.length) {
                // Group by size (stringify undefined sizes as empty string)
                const groups = item.unit.reduce((acc, u) => {
                    let key = '';
                    if (u && typeof u === 'object') key = String(u.size || '');
                    else key = String(u || '');
                    (acc[key] = acc[key] || []).push(u);
                    return acc;
                }, {});
                const html = Object.entries(groups).map(([size, opts]) => {
                    const sizeLabel = size || '';
                    const hasOptions = opts.some(o => o && typeof o === 'object' && o.option);
                    // If there are options for this size, show the size once as a header and then option rows
                    if (hasOptions) {
                        const optsHtml = opts.map(u => {
                            if (u && typeof u === 'object') {
                                const priceHtml = `<div class="text-orange-600 font-semibold">${formatPrice(u.price)}</div>`;
                                const label = u.option ? escapeHtml(u.option) : '';
                                return `<div class="flex items-center gap-3 mb-0.5"><div class="text-sm text-gray-700">${label}</div>${priceHtml}</div>`;
                            }
                            return `<div class="text-sm text-gray-700 mb-0.5">${escapeHtml(String(u))}</div>`;
                        }).join('');
                        return `<div class="mb-1">${sizeLabel ? `<div class="text-sm font-semibold text-gray-800 mb-0.5">${escapeHtml(sizeLabel)}</div>` : ''}${optsHtml}</div>`;
                    }
                    // No options: render rows with size and price (no extra header)
                    const rows = opts.map(u => {
                        if (u && typeof u === 'object') {
                            const priceHtml = `<div class="text-orange-600 font-semibold">${formatPrice(u.price)}</div>`;
                            return `<div class="flex items-center gap-3 mb-0.5"><div class="text-sm text-gray-700">${escapeHtml(sizeLabel)}</div>${priceHtml}</div>`;
                        }
                        return `<div class="text-sm text-gray-700 mb-0.5">${escapeHtml(String(u))}</div>`;
                    }).join('');
                    return `<div class="mb-1">${rows}</div>`;
                }).join('');
                return `<div class="space-y-1">${html}</div>`;
            }
            // Fallbacks: price / prices
            if (typeof item.price !== 'undefined') {
                return `<div class="space-y-1"><span class="text-orange-600 font-semibold">${formatPrice(item.price)}</span></div>`;
            }
            if (item.prices && typeof item.prices === 'object') {
                const html = Object.entries(item.prices).map(([k, v]) => `<div class="flex justify-between"><span class="text-sm text-gray-500">${escapeHtml(k)}</span><span class="text-orange-600">${formatPrice(v)}</span></div>`).join('');
                return `<div class="space-y-1">${html}</div>`;
            }
            if (typeof item.prices === 'string' || typeof item.prices === 'number') {
                return `<div class="space-y-1"><span class="text-orange-600 font-semibold">${formatPrice(item.prices)}</span></div>`;
            }
            return '';
        }

        // Firebase already initialized in firebase-config.js
        // db and appId are imported at the top

        async function fetchRestaurantData() {
            try {
                // Only fetch restaurant info/notes from Firestore in the future, or remove this if not needed
                // For now, clear info/notes
                document.getElementById('restaurantName').textContent = '';
                document.getElementById('restaurantInfo').innerHTML = '';
                document.getElementById('restaurantNotes').innerHTML = '';
                logInfo('Restaurant data initialized');
            } catch (error) {
                logError('Error initializing restaurant data', { error });
                // Non-critical error, continue loading
            }
        }

        function renderMenu(menuItems) {
            const menuContainer = document.getElementById('menuContainer');
            menuContainer.innerHTML = '';
            // Separate _info doc and menu items
            let restaurant = null;
            let notes = null;
            let menuDocs = [];
            for (const item of menuItems) {
                if (item._id === '_info') {
                    if (item.restaurant) restaurant = item.restaurant;
                    if (item.notes) notes = item.notes;
                } else {
                    menuDocs.push(item);
                }
            }
            // Render restaurant info (unchanged)
            const nameEl = document.getElementById('restaurantName');
            const infoEl = document.getElementById('restaurantInfo');
            const notesEl = document.getElementById('restaurantNotes');
            if (restaurant) {
                nameEl.textContent = restaurant.name || '';
                // ...existing code for hours and info rendering...
                
                // Replace any HH:MM tokens in a string with 12-hour formatted tokens
                function formatTimeString(s) {
                    if (s === null || s === undefined) return s;
                    // Only replace bare HH:MM occurrences that are NOT already followed by am/pm
                    return String(s).replace(/(\d{1,2}:\d{2})(?!\s*(?:am|pm))/gi, (m) => to12Hour(m));
                }

                function formatHours(hours) {
                    if (typeof hours === 'string') {
                        return `<span class='block'><b>Hours:</b> ${escapeHtml(formatTimeString(hours))}</span>`;
                    }
                    // If admin saved hours as an array of lines, render them directly (format times inside)
                    if (Array.isArray(hours)) {
                        return `<div class="flex flex-col items-center justify-center mt-2 mb-2">
                            <div class="flex items-center justify-center mb-1">
                                <span class="hours-icon">üïí</span>
                                <span class="hours-title text-lg" style="font-size:1.2rem;"><b>Hours:</b></span>
                            </div>
                            <div class="flex flex-col items-center">
                                ${hours.map(line => `<div class="text-base" style="margin-bottom:2px;">${escapeHtml(formatTimeString(String(line || '')))}</div>`).join('')}
                            </div>
                        </div>`;
                    }
                    // Otherwise expect an object keyed by weekday names
                    const days = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];
                    const groups = [];
                    let last = null, group = [];
                    for (const day of days) {
                        const h = hours ? hours[day] : null;
                        const key = (h && (h.open || h.close)) ? `${h.open ? to12Hour(h.open) : ''}-${h.close ? to12Hour(h.close) : ''}` : "Closed";
                        if (!last || last !== key) {
                            if (group.length) groups.push({days: group, key: last});
                            group = [day];
                            last = key;
                        } else {
                            group.push(day);
                        }
                    }
                    if (group.length) groups.push({days: group, key: last});
                    return `<div class="flex flex-col items-center justify-center mt-2 mb-2">
                        <div class="flex items-center justify-center mb-1">
                            <span class="hours-icon">üïí</span>
                            <span class="hours-title text-lg" style="font-size:1.2rem;"><b>Hours:</b></span>
                        </div>
                        <div class="flex flex-col items-center">
                            ${groups.map(g => {
                                const label = g.days.length > 1
                                    ? `<b>${g.days[0].slice(0,3)} - ${g.days[g.days.length-1].slice(0,3)}:</b>`
                                    : `<b>${g.days[0].slice(0,3)}:</b>`;
                                const display = g.key === 'Closed' ? '<span style="color:#b91c1c;font-weight:600;">Closed</span>' : String(g.key).replace(/^-|-$/g, '').replace(/-/g, ' - ');
                                return `<div class="text-base" style="margin-bottom:2px;">${label} ${display}</div>`;
                            }).join('')}
                        </div>
                    </div>`;
                }
                let formattedHours = '';
                if (restaurant.hours) {
                    formattedHours = formatHours(restaurant.hours);
                }
                infoEl.innerHTML = [
                    restaurant.location ? `<span class='block'><b>Address:</b> ${escapeHtml(restaurant.location)}</span>` : '',
                    restaurant.phone ? `<span class='block'><b>Phone:</b> ${escapeHtml(restaurant.phone)}</span>` : '',
                    formattedHours
                ].filter(Boolean).join('');
            } else {
                nameEl.textContent = '';
                infoEl.innerHTML = '';
            }
    if (notes) {
        let notesHtml = '';
        if (notes.combination_plate) {
            notesHtml += `
                <div class="important-note-box">
                    <span class="important-note-icon">üç±</span>
                    <span class="important-note-title">Combo Plate:</span>
                    <span class="important-note-text">${escapeHtml(notes.combination_plate)}</span>
                </div>
            `;
        }
        if (notes.lunch_special) {
            notesHtml += `
                <div class="important-note-box">
                    <span class="important-note-icon">‚è∞</span>
                    <span class="important-note-title">Lunch Special:</span>
                    <span class="important-note-text">${escapeHtml(notes.lunch_special)}</span>
                </div>
            `;
        }
        notesEl.innerHTML = notesHtml;
    } else {
        notesEl.innerHTML = '';
    }
            // Cache unfiltered docs for filter UI and interactions
            _cachedMenuItems = menuDocs.slice();
            // Render filter bar (collects tags from the full menu)
            renderFilterBar(_cachedMenuItems);

            // Apply filters (spicy and ingredient tags)
            let filteredDocs = menuDocs.filter(it => {
                if (spicyOnlyFilter && !it.spicy) return false;
                if (ingredientFilters.size > 0) {
                    const ing = it.ingredients || null;
                    if (!ing) return false;
                    const tokens = Array.isArray(ing) ? ing.map(normalizeIngredientToken) : String(ing).split(/[\n,]/).map(s => normalizeIngredientToken(s)).filter(Boolean);
                    // Keep item if it matches ANY selected ingredient token
                    const hasAny = Array.from(ingredientFilters).some(tok => tokens.includes(tok));
                    if (!hasAny) return false;
                }
                return true;
            });
            menuDocs = filteredDocs;

            if (!menuDocs || menuDocs.length === 0) {
                menuContainer.innerHTML = '<div class="text-center text-gray-400 text-xl py-12">Menu not available or under maintenance.</div>';
                return;
            }
            // Sort menuDocs by categoryOrder and itemOrder if present
            menuDocs = menuDocs.slice();
            menuDocs.sort((a, b) => {
                if (typeof a.categoryOrder === 'number' && typeof b.categoryOrder === 'number') {
                    if (a.categoryOrder !== b.categoryOrder) return a.categoryOrder - b.categoryOrder;
                    if (typeof a.itemOrder === 'number' && typeof b.itemOrder === 'number') {
                        return a.itemOrder - b.itemOrder;
                    }
                }
                return 0;
            });
            // Group by category (now in correct order)
            const groupedMenu = menuDocs.reduce((acc, item) => {
                (acc[item.category] = acc[item.category] || []).push(item);
                return acc;
            }, {});
            
            // Build category navigation
            const categoryList = document.getElementById('categoryList');
            categoryList.innerHTML = '';
            Object.keys(groupedMenu).forEach(category => {
                const categorySlug = category.toLowerCase().replace(/\s+/g, '-');
                const navItem = document.createElement('a');
                navItem.href = `#category-${categorySlug}`;
                navItem.className = 'block px-4 py-2 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors';
                navItem.textContent = category;
                navItem.addEventListener('click', (e) => {
                    // Close mobile menu after clicking
                    if (window.innerWidth < 1024) {
                        document.getElementById('categoryNav').classList.remove('translate-x-0');
                        document.getElementById('categoryNav').classList.add('-translate-x-full');
                        document.getElementById('sidebarOverlay').classList.add('hidden');
                    }
                });
                categoryList.appendChild(navItem);
            });
            
            // Render menu categories with IDs for navigation
            for (const category in groupedMenu) {
                const categorySlug = category.toLowerCase().replace(/\s+/g, '-');
                const categoryCard = document.createElement('div');
                categoryCard.classList.add('menu-card');
                categoryCard.id = `category-${categorySlug}`;
                // Get meta info from first item in category
                const firstItem = groupedMenu[category][0] || {};
                const chineseName = firstItem.chinese_name || '';
                const note = firstItem.note || '';
                categoryCard.innerHTML = `
                    <div class="category-header">
                        ${escapeHtml(category)}
                        ${chineseName ? `<span class='category-chinese'>${escapeHtml(chineseName)}</span>` : ''}
                    </div>
                    ${note ? `<div class='category-note'>${escapeHtml(note)}</div>` : ''}
                    <ul class="space-y-4">
                        ${groupedMenu[category].map(item => {
                            const details = buildDetailsHtml(item);
                            return `
                            <li class="border-b pb-2">
                                <div class="flex-grow">
                                    <h3 class="text-lg font-semibold">
                                        ${item.spicy ? `<span role="img" aria-label="spicy" title="Spicy" style="color:#be123c; margin-right:0.5rem; display:inline-block; vertical-align:middle;">üå∂Ô∏è</span>` : ''}${escapeHtml(item.name)}
                                    </h3>
                                    <p class="text-sm text-gray-500 mb-1">${escapeHtml(item.description || '')}</p>
                                    ${((Array.isArray(item.ingredients) && item.ingredients.length > 0) || (typeof item.ingredients === 'string' && item.ingredients.trim().length > 0)) ? `<div class="text-sm text-gray-600 mb-1"><b>Ingredients:</b> ${Array.isArray(item.ingredients) ? item.ingredients.map(i => escapeHtml(i)).join(', ') : escapeHtml(String(item.ingredients))}</div>` : ''}
                                    ${details ? details : ''}
                                </div>
                            </li>
                            `;
                        }).join('')}
                    </ul>
                `;
                menuContainer.appendChild(categoryCard);
            }
        }

        async function listenForMenuUpdates() {
            try {
                // db is already initialized from firebase-config.js import
                const menuRef = collection(db, `artifacts/${appId}/public/data/menu_data`);
                
                onSnapshot(menuRef, (querySnapshot) => {
                    try {
                        // If using Firestore, expect flat array
                        let menuItems = [];
                        querySnapshot.forEach((doc) => {
                            menuItems.push({ ...doc.data(), _id: doc.id });
                        });
                        // Normalize items to support both legacy nested-array and new flattened shapes
                        menuItems = menuItems.map(normalizeMenuItem);
                        renderMenu(menuItems);
                        
                        const loadingMsg = document.getElementById('loadingMessage');
                        if (loadingMsg) {
                            loadingMsg.classList.add('hidden');
                        }
                        
                        logInfo('Menu data loaded successfully', { itemCount: menuItems.length });
                    } catch (error) {
                        logError('Error processing menu data', { error });
                        showNotification('Failed to display menu. Please refresh the page.', 'error');
                    }
                }, (error) => {
                    logError('Error listening to Firestore', { error });
                    const loadingMsg = document.getElementById('loadingMessage');
                    if (loadingMsg) {
                        loadingMsg.textContent = 'Error loading menu. Please try again later.';
                        loadingMsg.classList.remove('hidden');
                    }
                    showNotification('Failed to load menu data. Please check your connection.', 'error');
                });
            } catch (error) {
                logError('Error initializing menu listener', { error });
                showNotification('Failed to initialize menu. Please refresh the page.', 'error');
            }
        }

        window.onload = async () => {
            try {
                // Firebase already initialized in firebase-config.js
                await fetchRestaurantData();
                listenForMenuUpdates();
                
                // Mobile menu toggle functionality
                const mobileToggle = document.getElementById('mobileMenuToggle');
                const closeSidebar = document.getElementById('closeSidebar');
                const categoryNav = document.getElementById('categoryNav');
                const overlay = document.getElementById('sidebarOverlay');
                const scrollToTopBtn = document.getElementById('scrollToTop');
                
                function openSidebar() {
                    if (!categoryNav || !overlay) return;
                    categoryNav.classList.remove('-translate-x-full');
                    categoryNav.classList.add('translate-x-0');
                    overlay.classList.remove('hidden');
                }
                
                function closeSidebarFunc() {
                    if (!categoryNav || !overlay) return;
                    categoryNav.classList.remove('translate-x-0');
                    categoryNav.classList.add('-translate-x-full');
                    overlay.classList.add('hidden');
                }
                
                // Event listeners with null checks
                if (mobileToggle) {
                    mobileToggle.addEventListener('click', openSidebar);
                }
                
                if (closeSidebar) {
                    closeSidebar.addEventListener('click', closeSidebarFunc);
                }
                
                if (overlay) {
                    overlay.addEventListener('click', closeSidebarFunc);
                }
                
                // Scroll to top button
                if (scrollToTopBtn) {
                    window.addEventListener('scroll', () => {
                        if (window.pageYOffset > 300) {
                            scrollToTopBtn.classList.add('show');
                        } else {
                            scrollToTopBtn.classList.remove('show');
                        }
                    });
                    
                    scrollToTopBtn.addEventListener('click', () => {
                        window.scrollTo({
                            top: 0,
                            behavior: 'smooth'
                        });
                    });
                }
                
                logInfo('Application initialized successfully');
            } catch (error) {
                logError('Critical error during initialization', { error });
                showNotification('Failed to initialize application. Please refresh the page.', 'error');
            }
        };
    </script>
</body>
</html>